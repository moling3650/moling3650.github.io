var e=(e,a,t)=>new Promise(((l,o)=>{var s=e=>{try{r(t.next(e))}catch(a){o(a)}},n=e=>{try{r(t.throw(e))}catch(a){o(a)}},r=e=>e.done?l(e.value):Promise.resolve(e.value).then(s,n);r((t=t.apply(e,a)).next())}));import{r as a,d as t,V as l,c as o,w as s,b as n,j as r,ac as d,l as u,k as i,e as c,f as m,i as p,h as f,u as h,t as w,x as v,ao as x,a as _,_ as g}from"./index-RoK83ArO.js";import{_ as y}from"./wd-cell-group.3GkSAsMM.js";import{_ as b}from"./wd-form.DQzDVVkH.js";import{s as V,v as j}from"./login.Bc05IcUz.js";import"./http.D-V8nre_.js";const C=g(t({__name:"login",setup(t){const{countdown:g,start:C}=((e=60)=>{const t=a(0);return{countdown:t,start:()=>{t.value=e;const a=setInterval((()=>{t.value<=0?clearInterval(a):t.value--}),1e3)}}})(60),k=a(),q=l({phone:"",smsCode:""});function I(){return e(this,null,(function*(){if(g.value)v({title:"请稍后再试",icon:"none"});else if(q.phone){C();const e=yield V(q.phone);0===e.code?v({title:"发送成功",icon:"none"}):v({title:e.message,icon:"none"})}else v({title:"请输入手机号",icon:"none"})}))}function P(){k.value.validate().then((a=>e(this,[a],(function*({valid:e}){if(e){const e=yield j();0===e.code?(v({title:"登录成功",icon:"none"}),x().setPhone(q.phone),_({url:"/pages/mine/mine"})):v({title:e.message})}}))))}return(e,a)=>{const t=p,l=r(u("wd-input"),d),v=r(u("wd-button"),i),x=r(u("wd-cell-group"),y),_=r(u("wd-form"),b),V=n("layout-default-uni");return c(),o(V,null,{default:s((()=>[m(t,{class:"overflow-hidden w-screen h-screen bg"},{default:s((()=>[m(t,{class:"relative top-20 px-8 py-4 mx-4 bg-white rounded-3xl leading-relaxed"},{default:s((()=>[m(t,{class:"mb-4 fw-semibold text-center"},{default:s((()=>[f("用户登录")])),_:1}),m(_,{ref_key:"formRef",ref:k,model:h(q),"error-type":"toast",class:"ex-form"},{default:s((()=>[m(x,null,{default:s((()=>[m(l,{modelValue:h(q).phone,"onUpdate:modelValue":a[0]||(a[0]=e=>h(q).phone=e),prop:"phone",label:"手机号","label-width":"72px",placeholder:"请输入手机号",focus:"",rules:[{required:!0,message:"请输入手机号"},{required:!0,pattern:/^1[3-9]\d{9}$/,message:"手机号格式错误"}]},{suffix:s((()=>[m(t,{class:"w-20 py-0.5 rounded text-sm text-center text-white bg-[#5a4ac5]",onClick:I},{default:s((()=>[f(w(h(g)?`${h(g)}秒`:"获取验证码"),1)])),_:1})])),_:1},8,["modelValue"]),m(l,{modelValue:h(q).smsCode,"onUpdate:modelValue":a[1]||(a[1]=e=>h(q).smsCode=e),prop:"smsCode",label:"验证码","label-width":"72px",placeholder:"请输入短信验证码",rules:[{required:!0,message:"请输入短信验证码"}]},null,8,["modelValue"]),m(v,{type:"primary",block:"",class:"my-6",onClick:P},{default:s((()=>[f("登录")])),_:1})])),_:1})])),_:1},8,["model"])])),_:1})])),_:1})])),_:1})}}}),[["__scopeId","data-v-d8a7ae0a"]]);export{C as default};
